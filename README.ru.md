# Screener: Анализ Скриншотов с Помощью Ollama

Screener — это настольное приложение, которое позволяет захватывать области экрана и отправлять их на локальный экземпляр Ollama для анализа, описания, генерации кода, перевода или выполнения пользовательских задач. Приложение поддерживает глобальные горячие клавиши для быстрого захвата и имеет иконку в системном трее для удобного доступа.

## Возможности

*   **Захват Области:** Ручной выбор любой части экрана для анализа.
*   **Интеграция с Ollama:** Использует локальный экземпляр Ollama для мощной обработки изображений и преобразования их в текст.
    *   Настраиваемые URL-адрес и модель Ollama.
*   **Предопределенные Действия через Горячие Клавиши:**
    *   **Решить/Описать:** Анализ математических, логических или технических проблем, или описание изображения, если это не проблема.
    *   **Описать Изображение:** Подробное описание содержимого изображения.
    *   **Сгенерировать Код:** Если изображение описывает задачу по программированию, генерирует соответствующий Python-код и объяснение.
    *   **Перевести на Русский:** Перевод текста на изображении на русский язык или описание изображения на русском.
*   **Пользовательские Запросы:**
    *   Используйте специальную горячую клавишу для захвата с пользовательским запросом, введенным в главном окне приложения.
    *   Запускайте захват вручную из интерфейса с пользовательским запросом.
*   **Глобальные Горячие Клавиши:** Настраиваемые горячие клавиши для всех предопределенных действий (конфигурируются в `hotkeys.json`).
*   **Интеграция с Системным Треем:**
    *   Показать/Скрыть главное окно приложения.
    *   Быстрое действие захвата.
    *   Выбор языка.
    *   Выбор темы (Светлая/Тёмная).
    *   Выход из приложения.
*   **Интернационализация (i18n):**
    *   Поддержка английского (en) и русского (ru) языков.
    *   Тексты интерфейса и описания горячих клавиш локализованы.
    *   Язык можно изменить во время работы через меню в трее.
*   **Темы Оформления:**
    *   Доступны светлая и тёмная темы, переключаемые из меню в трее.
*   **Форматированные Ответы:**
    *   Ответы от Ollama отображаются в отдельном окне с базовой поддержкой Markdown (жирный, курсив, заголовки, списки, блоки кода).
    *   Подсветка синтаксиса Python внутри блоков кода ` ```python ... ``` `.
    *   Регулируемый размер шрифта для текста ответа.
    *   Копирование ответа в буфер обмена.
*   **Кроссплатформенность (Концептуально):** Создано с использованием Python и Tkinter, нацелено на кроссплатформенную совместимость (Windows, macOS, Linux), однако `pynput` (для глобальных горячих клавиш) и `pystray` могут иметь специфичные для платформы зависимости или требования к настройке.

## Предварительные Требования

*   **Python 3.8+**
*   **Ollama:** Запущенный локальный экземпляр [Ollama](https://ollama.ai/).
    *   Убедитесь, что модель, указанная в `settings.py` (по умолчанию: `gemma3:12b`), загружена и доступна в вашем экземпляре Ollama (например, `ollama pull gemma3:12b`).
*   **Tcl/Tk:** Обычно поставляется с Python, но убедитесь, что это версия, хорошо поддерживающая темы ttk (рекомендуется Tk 8.6+).

## Установка

1.  **Клонируйте Репозиторий:**
    ```bash
    git clone <URL_репозитория>
    cd screener
    ```

2.  **Создайте Виртуальное Окружение (Рекомендуется):**
    ```bash
    python -m venv venv
    # В Windows
    venv\Scripts\activate
    # В macOS/Linux
    source venv/bin/activate
    ```

3.  **Установите Зависимости:**
    ```bash
    pip install -r requirements.txt
    ```
    *Примечание: В Linux может потребоваться установка дополнительных пакетов для корректной работы `pynput` (например, `python3-dev`, `libudev-dev`, `libx11-dev`, `xorg-dev` или аналогичные, в зависимости от вашего дистрибутива и используете ли вы X11 или Wayland).*
    *Для `pystray` в Linux могут потребоваться `libappindicator3-dev` или `libayatana-appindicator3-dev` и связанные компоненты для наилучшей работы иконок системного трея.*

## Конфигурация

Основное поведение приложения настраивается через переменные окружения, управляемые с помощью файла `.env` в корне проекта. Создайте файл `.env`, скопировав `.env.example`, и измените значения:

*   `OLLAMA_URL`: URL-адрес вашего API-эндпоинта Ollama (по умолчанию: `http://localhost:11434/api/generate`).
*   `OLLAMA_MODEL`: Модель Ollama для использования (например, `gemma3:12b`, `llama3:8b`).
*   `DEFAULT_LANGUAGE`: Язык приложения по умолчанию ('en' или 'ru').
*   `DEFAULT_THEME`: Тема оформления по умолчанию ('light' или 'dark').
*   `OLLAMA_TIMEOUT_SECONDS`: Таймаут для запросов к Ollama (по умолчанию: 120).
*   `ICON_PATH`: Необязательный путь к пользовательской иконке приложения.

Другие внутренние настройки (такие как размеры UI, специфичные оттенки цветов, не входящие в основную тему) находятся в `settings.py`.

Горячие клавиши определены в `hotkeys.json`:
*   Здесь вы можете изменить комбинации клавиш и стандартные запросы/описания.
*   Убедитесь, что комбинации горячих клавиш действительны для `pynput`.

Тексты интерфейса и переводы находятся в `ui_texts.json`.

## Использование

1.  **Убедитесь, что Ollama запущен.**
2.  **Запустите Приложение:**
    ```bash
    python screener.py
    ```
3.  **Использование Горячих Клавиш:**
    *   Нажмите настроенную горячую клавишу для нужного действия (например, `Ctrl+Alt+S` для "Решить/Описать").
    *   Курсор изменится на перекрестие. Нажмите и перетащите, чтобы выбрать область экрана.
    *   Отпустите кнопку мыши для захвата.
    *   Изображение будет отправлено в Ollama, и ответ появится в новом окне.
4.  **Использование Главного Окна:**
    *   Введите пользовательский запрос в поле ввода, если хотите использовать горячую клавишу "Пользовательский запрос" или запустить вручную.
    *   Нажмите "Захватить область вручную" для запуска захвата со стандартным действием "описать" (или с пользовательским запросом, если для действия "описать" установлено значение `CUSTOM_PROMPT_PLACEHOLDER` и вы заполнили поле).
5.  **Использование Иконки в Системном Трее:**
    *   Щелкните правой кнопкой мыши по иконке в трее для доступа к опциям: Показать/Скрыть окно, Захватить, Язык, Тема, Выход.

## Устранение Неполадок

*   **Ошибки Подключения к Ollama:**
    *   Убедитесь, что Ollama запущен и доступен по настроенному `OLLAMA_URL`.
    *   Проверьте, доступна ли указанная `OLLAMA_MODEL` в вашем экземпляре Ollama.
    *   Межсетевой экран может блокировать соединение.
*   **Проблемы с Горячими Клавишами:**
    *   Убедитесь, что никакое другое приложение не использует те же глобальные горячие клавиши.
    *   В macOS может потребоваться предоставить права доступа (accessibility permissions) вашему терминалу или интерпретатору Python.
    *   В Linux (особенно Wayland) поддержка глобальных горячих клавиш может быть сложной. `pynput` может требовать определенных переменных окружения или слоев совместимости с X11.
*   **Иконка в Трее Не Отображается:**
    *   `pystray` может требовать специфических библиотек (например, `libappindicator` в Linux).
    *   Некоторые среды рабочего стола могут не полностью поддерживать устаревшие иконки трея.
*   **Ошибка TclError "Unknown option -bordercolor":** Ваша версия Tcl/Tk старше 8.6.11. Приложение должно работать, но рамки блоков кода могут не иметь настраиваемых цветов.

## Файлы

*   `screener.py`: Основная логика приложения и пользовательский интерфейс.
*   `settings.py`: Настройки приложения, цвета тем, конфигурация языка.
*   `ollama_utils.py`: Обрабатывает взаимодействие с API Ollama.
*   `capture.py`: Управляет оверлеем захвата экрана и процессом.
*   `ui_utils.py`: Вспомогательные функции для UI, включая форматирование Markdown/синтаксиса.
*   `hotkeys.json`: Определения горячих клавиш и связанных с ними запросов.
*   `ui_texts.json`: Определения локализованных строк интерфейса.
*   `requirements.txt`: Зависимости пакетов Python.
*   `icon.png`: Иконка приложения для трея и окна.
*   `.gitignore`: Указывает намеренно неотслеживаемые файлы для Git.

## Участие в Разработке

Мы приветствуем ваш вклад! Пожалуйста, не стесняйтесь форкнуть репозиторий, вносить изменения и отправлять pull request.

## Лицензия

Этот проект с открытым исходным кодом. Пожалуйста, добавьте файл лицензии (например, MIT, Apache 2.0), если вы намерены его широко распространять. (В настоящее время без лицензии)